<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jiguluck: Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            user-select: none;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        /* –Ø—á–µ–π–∫–∏ */
        .slot-cell {
            position: relative;
            background: linear-gradient(145deg, #1e293b, #0f172a);
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.5), inset -2px -2px 5px rgba(255,255,255,0.05);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–°—Ç–∏–∫–µ—Ä–æ–≤) */
        .emoji-content {
            width: 80%;
            height: 80%;
            object-fit: contain;
            filter: drop-shadow(0 4px 2px rgba(0,0,0,0.5));
            transition: transform 0.1s;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è (–±–ª—é—Ä + —Ç—Ä—è—Å–∫–∞) */
        .spinning .emoji-content { 
            filter: blur(5px); 
            opacity: 0.8;
            animation: slotBlur 0.1s infinite linear; 
        }

        @keyframes slotBlur {
            0% { transform: translateY(-15px) scale(0.9); }
            50% { transform: translateY(15px) scale(0.9); }
            100% { transform: translateY(-15px) scale(0.9); }
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–±–µ–¥—ã —è—á–µ–π–∫–∏ */
        .win-anim {
            background: radial-gradient(circle, rgba(251, 191, 36, 0.3) 0%, rgba(30, 41, 59, 1) 70%);
            border: 2px solid #fbbf24;
            z-index: 20;
            box-shadow: 0 0 20px #fbbf24;
            transform: scale(1.05);
        }

        /* –í—Å–ø–ª—ã–≤–∞—é—â–∏–π –≤—ã–∏–≥—Ä—ã—à */
        .float-win {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            font-weight: 900;
            color: #facc15;
            text-shadow: 0 4px 0 #854d0e, 0 0 20px rgba(250, 204, 21, 0.6);
            pointer-events: none;
            z-index: 50;
            animation: floatUp 1.5s ease-out forwards;
        }

        @keyframes floatUp {
            0% { opacity: 0; transform: translate(-50%, -30%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -120%) scale(1); }
        }

        #lines-svg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 15; pointer-events: none;
        }
        .payline {
            fill: none; stroke-width: 8; stroke-linecap: round; stroke-linejoin: round;
            opacity: 0.8; filter: drop-shadow(0 0 4px rgba(0,0,0,0.8));
        }

        /* –ö–Ω–æ–ø–∫–∞ 3D */
        .btn-3d {
            transition: all 0.1s;
            box-shadow: 0px 6px 0px var(--shadow-color, #581c87); 
            transform: translateY(0);
        }
        .btn-3d:hover {
            transform: translateY(-2px);
            box-shadow: 0px 8px 0px var(--shadow-color, #581c87);
        }
        .btn-3d:active {
            transform: translateY(6px);
            box-shadow: 0px 0px 0px var(--shadow-color, #581c87);
        }
        .btn-3d:disabled {
            opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none;
        }

        .big-win-text {
            font-size: 4rem; font-weight: 900;
            background: linear-gradient(to bottom, #fcd34d, #d97706);
            -webkit-background-clip: text; color: transparent;
            text-shadow: 0 4px 20px rgba(217, 119, 6, 0.5);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        
        .bounce { animation: land 0.3s ease-out; }
        @keyframes land { 0% { transform: translateY(-20px); } 50% { transform: translateY(5px); } 100% { transform: translateY(0); } }

    </style>
</head>
<body class="flex flex-col min-h-screen overflow-x-hidden bg-[url('https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center bg-fixed">
    <div class="absolute inset-0 bg-slate-900/80 backdrop-blur-sm"></div>

    <nav class="w-full py-3 px-6 flex justify-between items-center border-b border-white/10 bg-slate-900/90 fixed top-0 z-50">
        <div class="flex items-center gap-2">
            <span class="text-2xl">üé∞</span>
            <div class="text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                JIGULUCK
            </div>
        </div>
        <div class="flex gap-3">
            <button onclick="toggleSound()" id="sound-btn" class="p-2 rounded-full bg-slate-800 hover:bg-slate-700 transition text-slate-400">üîä</button>
            <button onclick="resetGame()" class="px-3 py-1 bg-red-900/50 hover:bg-red-800 border border-red-700 rounded text-xs font-bold text-red-200 transition">–°–ë–†–û–°</button>
        </div>
    </nav>

    <section id="game" class="pt-24 pb-10 flex-grow flex flex-col items-center justify-center relative z-10">
        <div class="container mx-auto px-4 text-center max-w-md">
            
            <div class="glass-panel p-4 rounded-3xl shadow-2xl border border-slate-700/50 mt-2">
                
                <!-- –¢–∞–±–ª–æ -->
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="bg-slate-950/50 p-3 rounded-xl border border-slate-700/50 text-left relative overflow-hidden">
                        <p class="text-[10px] text-slate-400 font-bold uppercase">–ë–∞–ª–∞–Ω—Å</p>
                        <p class="text-2xl font-mono text-green-400 font-bold" id="balance">1000</p>
                    </div>
                    <div class="bg-slate-950/50 p-3 rounded-xl border border-slate-700/50 text-right relative overflow-hidden">
                        <p class="text-[10px] text-slate-400 font-bold uppercase">–í—ã–∏–≥—Ä—ã—à</p>
                        <p class="text-2xl font-mono text-yellow-400 font-bold" id="last-win">0</p>
                    </div>
                </div>

                <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
                <div class="relative mb-5 mx-auto w-full aspect-square" id="game-container">
                    <div class="absolute -inset-3 bg-gradient-to-b from-purple-600 to-blue-900 rounded-2xl opacity-50 blur-lg"></div>
                    <div class="bg-slate-900 p-3 rounded-xl border-4 border-slate-800 shadow-2xl relative h-full w-full z-10">
                        <div class="grid grid-cols-3 grid-rows-3 gap-2 h-full relative" id="slot-grid"></div>
                        <svg id="lines-svg" viewBox="0 0 316 316" preserveAspectRatio="none"></svg>
                    </div>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
                <div class="space-y-4">
                    <div class="bg-slate-800/40 p-3 rounded-xl border border-slate-700/50">
                        <div class="flex flex-col gap-1 mb-3">
                            <div class="flex justify-between text-[10px] uppercase font-bold text-slate-500 px-1">
                                <span>–õ–∏–Ω–∏–∏</span>
                                <span id="lines-desc" class="text-blue-400">3 –∞–∫—Ç–∏–≤–Ω—ã—Ö</span>
                            </div>
                            <div class="flex gap-1 justify-between" id="lines-buttons"></div>
                        </div>

                        <div class="flex items-end justify-between gap-2">
                            <div class="flex-1">
                                <p class="text-[9px] text-slate-400 uppercase mb-1 text-left">–°—Ç–∞–≤–∫–∞ / –õ–∏–Ω–∏—è</p>
                                <div class="flex items-center gap-2 bg-slate-900/50 rounded-lg p-1 border border-slate-700">
                                    <button onclick="changeBet(-10)" class="w-8 h-8 rounded bg-slate-700 hover:bg-slate-600 text-white font-bold">-</button>
                                    <span class="flex-1 font-mono font-bold text-white" id="bet-per-line">10</span>
                                    <button onclick="changeBet(10)" class="w-8 h-8 rounded bg-slate-700 hover:bg-slate-600 text-white font-bold">+</button>
                                </div>
                            </div>
                            <button onclick="setMaxBet()" class="h-10 px-3 rounded-lg bg-slate-700 hover:bg-slate-600 text-[10px] font-bold text-orange-300 border border-slate-600 uppercase leading-tight transition active:scale-95">
                                Max<br>Bet
                            </button>
                        </div>
                    </div>

                    <div class="flex justify-between items-center text-xs font-bold text-slate-400 bg-slate-950/50 rounded-lg px-3 py-2 border border-slate-800">
                        <span>–í—Å–µ–≥–æ: <span id="total-bet" class="text-white text-sm">30</span></span>
                        <span id="status-msg" class="truncate max-w-[180px] text-right">–£–¥–∞—á–∏!</span>
                    </div>

                    <div class="flex gap-3 mt-2 h-16">
                        <button id="auto-btn" onclick="toggleAutoSpin()" class="w-1/4 rounded-xl bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold text-xs flex flex-col items-center justify-center border-b-4 border-slate-800 active:border-b-0 active:translate-y-1 transition-all">
                            <span>üîÑ</span> AUTO
                        </button>
                        <button id="spin-btn" onclick="spin()" class="w-3/4 btn-3d bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-black text-2xl tracking-widest rounded-xl" style="--shadow-color: #581c87;">
                            SPIN
                        </button>
                    </div>
                </div>
            </div>

            <!-- –õ–ï–ì–ï–ù–î–ê (–û–ë–ù–û–í–õ–ï–ù–ê –ü–û–î –ö–ê–†–¢–ò–ù–ö–ò) -->
            <div class="mt-6 grid grid-cols-4 gap-2 text-center opacity-90 max-w-md mx-auto">
                <!-- –°–∞–º—ã–µ —Ä–µ–¥–∫–∏–µ -->
                <div class="bg-slate-800/60 p-2 rounded border border-slate-700/50 flex flex-col items-center justify-center">
                    <img src="stickers/8.webp" class="w-8 h-8 object-contain mb-1">
                    <span class="text-[10px] font-bold text-yellow-400">x100</span>
                </div>
                <div class="bg-slate-800/60 p-2 rounded border border-slate-700/50 flex flex-col items-center justify-center">
                    <img src="stickers/7.webp" class="w-8 h-8 object-contain mb-1">
                    <span class="text-[10px] font-bold text-yellow-400">x50</span>
                </div>
                <div class="bg-slate-800/60 p-2 rounded border border-slate-700/50 flex flex-col items-center justify-center">
                    <img src="stickers/6.webp" class="w-8 h-8 object-contain mb-1">
                    <span class="text-[10px] font-bold text-yellow-400">x25</span>
                </div>
                <div class="bg-slate-800/60 p-2 rounded border border-slate-700/50 flex flex-col items-center justify-center">
                    <img src="stickers/5.webp" class="w-8 h-8 object-contain mb-1">
                    <span class="text-[10px] font-bold text-yellow-400">x20</span>
                </div>
                <!-- –°—Ä–µ–¥–Ω–∏–µ –∏ —á–∞—Å—Ç—ã–µ -->
                <div class="bg-slate-800/60 p-2 rounded border border-slate-700/50 flex flex-col items-center justify-center">
                    <img src="stickers/4.webp" class="w-8 h-8 object-contain mb-1">
                    <span class="text-[10px] font-bold text-yellow-400">x15</span>
                </div>
                <div class="bg-slate-800/60 p-2 rounded border border-slate-700/50 flex flex-col items-center justify-center">
                    <img src="stickers/3.webp" class="w-8 h-8 object-contain mb-1">
                    <span class="text-[10px] font-bold text-yellow-400">x10</span>
                </div>
                <div class="bg-slate-800/60 p-2 rounded border border-slate-700/50 flex flex-col items-center justify-center">
                    <img src="stickers/2.webp" class="w-8 h-8 object-contain mb-1">
                    <span class="text-[10px] font-bold text-yellow-400">x10</span>
                </div>
                <div class="bg-slate-800/60 p-2 rounded border border-slate-700/50 flex flex-col items-center justify-center">
                    <img src="stickers/1.webp" class="w-8 h-8 object-contain mb-1">
                    <span class="text-[10px] font-bold text-yellow-400">x5</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Big Win Modal -->
    <div id="win-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/90 backdrop-blur-sm" onclick="closeModal()">
        <div class="text-center relative animate-bounce">
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-yellow-500 rounded-full mix-blend-screen filter blur-[100px] opacity-30"></div>
            <h2 class="big-win-text mb-4">BIG WIN!</h2>
            <p class="text-6xl font-mono text-white font-bold drop-shadow-lg" id="modal-amount">0</p>
            <p class="text-slate-400 mt-6 text-sm uppercase tracking-widest">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</p>
        </div>
    </div>

    <script>
        // --- –ö–û–ù–§–ò–ì: –°—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã 1.webp - 8.webp ---
        // 8 - —Å–∞–º—ã–π —Ä–µ–¥–∫–∏–π (x50), 1 - —Å–∞–º—ã–π —á–∞—Å—Ç—ã–π (x5)
        const SYMBOLS = [
            { icon: 'stickers/8.webp', weight: 3, payout: 100 },
            { icon: 'stickers/7.webp', weight: 5, payout: 50 },
            { icon: 'stickers/6.webp', weight: 10, payout: 25 },
            { icon: 'stickers/5.webp', weight: 12, payout: 20 },
            { icon: 'stickers/4.webp', weight: 15, payout: 15 },
            { icon: 'stickers/3.webp', weight: 20, payout: 10 },
            { icon: 'stickers/2.webp', weight: 20, payout: 10 },
            { icon: 'stickers/1.webp', weight: 30, payout: 5 }
        ];

        const LINES_CONFIG = [
            { path: [[1,0], [1,1], [1,2]], color: '#ef4444' },
            { path: [[0,0], [0,1], [0,2]], color: '#f97316' },
            { path: [[2,0], [2,1], [2,2]], color: '#eab308' },
            { path: [[0,0], [1,1], [2,2]], color: '#22c55e' },
            { path: [[2,0], [1,1], [0,2]], color: '#3b82f6' },
            { path: [[0,0], [1,1], [0,2]], color: '#a855f7' },
            { path: [[2,0], [1,1], [2,2]], color: '#ec4899' },
            { path: [[1,0], [0,1], [1,2]], color: '#06b6d4' },
            { path: [[1,0], [2,1], [1,2]], color: '#6366f1' }
        ];

        // --- –°–û–°–¢–û–Ø–ù–ò–ï ---
        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–ø–æ–ª–Ω—è–µ–º —Å–∞–º—ã–º–∏ —á–∞—Å—Ç—ã–º–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ (1.webp), —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ø—É—Å—Ç—ã—Ö –º–µ—Å—Ç
        let state = {
            balance: parseInt(localStorage.getItem('slotBal')) || 1000,
            bet: 20,
            lines: 5,
            spinning: false,
            auto: false,
            sound: true,
            grid: Array(3).fill().map(() => Array(3).fill('stickers/1.webp'))
        };

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const playTone = (freq, type, dur, vol=0.1) => {
            if(!state.sound || audioCtx.state === 'suspended') { if(state.sound) audioCtx.resume(); if(!state.sound) return; }
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + dur);
        };

        const sounds = {
            click: () => playTone(800, 'sine', 0.05),
            spin: () => playTone(200 + Math.random()*100, 'triangle', 0.05, 0.05),
            land: () => playTone(100, 'square', 0.1, 0.1),
            win: () => { [523, 659, 783, 1046].forEach((f, i) => setTimeout(() => playTone(f, 'sine', 0.3, 0.2), i*100)); }
        };

        const dom = {
            grid: document.getElementById('slot-grid'),
            svg: document.getElementById('lines-svg'),
            bal: document.getElementById('balance'),
            win: document.getElementById('last-win'),
            bet: document.getElementById('bet-per-line'),
            total: document.getElementById('total-bet'),
            msg: document.getElementById('status-msg'),
            spin: document.getElementById('spin-btn'),
            auto: document.getElementById('auto-btn'),
            linesBox: document.getElementById('lines-buttons'),
            modal: document.getElementById('win-modal'),
            gameContainer: document.querySelector('.bg-slate-900.relative')
        };

        function init() {
            renderGrid();
            renderLinesBtns();
            updateUI();
            window.addEventListener('resize', () => { if(!state.spinning) clearLines(); });
        }

        function renderGrid() {
            dom.grid.innerHTML = '';
            for(let r=0; r<3; r++) {
                for(let c=0; c<3; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'slot-cell rounded-lg overflow-hidden';
                    cell.id = `c-${r}-${c}`;
                    // –°–æ–∑–¥–∞–µ–º <img> –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞
                    cell.innerHTML = `<img src="${state.grid[r][c]}" class="emoji-content" alt="icon" draggable="false">`;
                    dom.grid.appendChild(cell);
                }
            }
        }

        function renderLinesBtns() {
            dom.linesBox.innerHTML = '';
            [1, 3, 5, 7, 9].forEach(n => {
                const b = document.createElement('button');
                b.className = `flex-1 py-1 rounded border text-[10px] font-bold transition ${n === state.lines ? 'bg-blue-600 border-blue-400 text-white' : 'bg-slate-800 border-slate-600 text-slate-400'}`;
                b.innerText = n;
                b.onclick = () => { if(!state.spinning) { state.lines = n; sounds.click(); renderLinesBtns(); updateUI(); }};
                b.onmouseenter = () => { if(!state.spinning) previewLines(n); };
                b.onmouseleave = () => { if(!state.spinning) clearLines(); };
                dom.linesBox.appendChild(b);
            });
            document.getElementById('lines-desc').innerText = `${state.lines} –∞–∫—Ç–∏–≤–Ω—ã—Ö`;
        }

        const getCoord = (r, c) => {
            const gap = 8, size = (316 - 16)/3, half = size/2;
            return { x: c*size + c*gap + half, y: r*size + r*gap + half };
        };
        function drawPath(idx) {
            const pts = LINES_CONFIG[idx].path.map(([r,c]) => getCoord(r,c));
            let d = `M ${pts[0].x} ${pts[0].y} L ${pts[1].x} ${pts[1].y} L ${pts[2].x} ${pts[2].y}`;
            return `<path d="${d}" stroke="${LINES_CONFIG[idx].color}" class="payline" />`;
        }
        function previewLines(n) { dom.svg.innerHTML = Array(n).fill(0).map((_, i) => drawPath(i)).join(''); }
        function clearLines() { dom.svg.innerHTML = ''; }

        function getPool(boostSyms = []) {
            let pool = [];
            SYMBOLS.forEach(s => {
                let count = s.weight;
                if(boostSyms.includes(s.icon)) count += 30;
                for(let i=0; i<count; i++) pool.push(s.icon);
            });
            return pool;
        }

        function updateUI() {
            dom.bal.innerText = state.balance;
            dom.bet.innerText = state.bet;
            const total = state.bet * state.lines;
            dom.total.innerText = total;
            localStorage.setItem('slotBal', state.balance);
            
            dom.spin.disabled = state.spinning;
            if(state.balance < total) {
                dom.msg.innerHTML = "<span class='text-red-400'>–ú–∞–ª–æ –¥–µ–Ω–µ–≥</span>";
                if(state.auto) toggleAutoSpin();
            } else if (!state.spinning && dom.win.innerText === "0") {
                dom.msg.innerText = "–£–¥–∞—á–∏!";
            }
        }

        function changeBet(d) {
            if(state.spinning) return;
            let n = state.bet + d;
            if(n >= 10 && n <= 200) { state.bet = n; sounds.click(); updateUI(); }
        }
        function setMaxBet() {
            if(state.spinning) return;
            state.bet = 200; state.lines = 9;
            sounds.click(); renderLinesBtns(); updateUI();
        }
        function toggleAutoSpin() {
            state.auto = !state.auto;
            dom.auto.innerHTML = state.auto ? "üõë" : "üîÑ<br>AUTO";
            if(state.auto && !state.spinning) spin();
        }

        function showFloatingWin(amount) {
            const el = document.createElement('div');
            el.className = 'float-win';
            el.innerText = '+' + amount;
            dom.gameContainer.appendChild(el);
            setTimeout(() => el.remove(), 1500);
        }

        function spin() {
            const cost = state.bet * state.lines;
            if(state.spinning || state.balance < cost) return;

            state.spinning = true;
            state.balance -= cost;
            dom.win.innerText = "0";
            clearLines();
            updateUI();
            sounds.click();
            dom.msg.innerText = "–ö—Ä—É—Ç–∏–º...";

            document.querySelectorAll('.win-anim').forEach(el => el.classList.remove('win-anim'));

            let res = [[], [], []];
            let c0 = [];
            let pool0 = getPool();
            for(let r=0; r<3; r++) { 
                let s = pool0[Math.floor(Math.random()*pool0.length)]; 
                res[r][0] = s; c0.push(s); 
            }

            let c1 = [];
            let pool1 = getPool(c0);
            for(let r=0; r<3; r++) { 
                let s = pool1[Math.floor(Math.random()*pool1.length)]; 
                res[r][1] = s; c1.push(s); 
            }

            let pool2 = getPool(c1);
            for(let r=0; r<3; r++) res[r][2] = pool2[Math.floor(Math.random()*pool2.length)];

            for(let c=0; c<3; c++) {
                for(let r=0; r<3; r++) {
                    const cell = document.getElementById(`c-${r}-${c}`);
                    const content = cell.querySelector('.emoji-content'); // –≠—Ç–æ IMG
                    cell.classList.add('spinning');
                    
                    const iv = setInterval(() => {
                        // –ú–µ–Ω—è–µ–º SRC –∫–∞—Ä—Ç–∏–Ω–∫–∏
                        content.src = pool0[Math.floor(Math.random()*pool0.length)];
                    }, 80);

                    setTimeout(() => {
                        clearInterval(iv);
                        cell.classList.remove('spinning');
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π SRC
                        content.src = res[r][c];
                        content.classList.add('bounce');
                        sounds.land();
                        setTimeout(() => content.classList.remove('bounce'), 300);
                        state.grid[r][c] = res[r][c];
                        if(c===2 && r===2) checkWin(res);
                    }, 600 + (c * 400));
                }
            }
        }

        function checkWin(grid) {
            let totalWin = 0;
            let winLines = [];
            
            for(let i=0; i<state.lines; i++) {
                const path = LINES_CONFIG[i].path;
                const s1 = grid[path[0][0]][path[0][1]];
                const s2 = grid[path[1][0]][path[1][1]];
                const s3 = grid[path[2][0]][path[2][1]];

                if(s1 === s2 && s1 === s3) {
                    const symData = SYMBOLS.find(s => s.icon === s1);
                    totalWin += state.bet * symData.payout;
                    winLines.push(i);
                    path.forEach(([r,c]) => document.getElementById(`c-${r}-${c}`).classList.add('win-anim'));
                }
            }

            state.spinning = false;
            if(totalWin > 0) {
                state.balance += totalWin;
                dom.win.innerText = totalWin;
                dom.msg.innerHTML = `<span class="text-yellow-400 font-bold animate-pulse">–í–´–ò–ì–†–´–®: ${totalWin}!</span>`;
                showFloatingWin(totalWin);
                dom.svg.innerHTML = winLines.map(i => drawPath(i)).join('');
                sounds.win();

                if(totalWin >= state.bet * state.lines * 15) {
                    document.getElementById('modal-amount').innerText = totalWin;
                    dom.modal.classList.remove('hidden');
                }
            } else {
                dom.msg.innerText = "–ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞!";
            }
            
            updateUI();
            if(state.auto && state.balance > 0) setTimeout(spin, 1500);
        }

        function resetGame() {
            if(confirm("–°–±—Ä–æ—Å?")) { state.balance = 1000; updateUI(); }
        }
        function closeModal() { dom.modal.classList.add('hidden'); }
        function toggleSound() { state.sound = !state.sound; document.getElementById('sound-btn').innerText = state.sound ? "üîä" : "üîá"; }

        init();
    </script>
</body>
</html>

